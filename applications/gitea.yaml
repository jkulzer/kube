apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: gitea
  namespace: argocd
spec:
  destination:
    namespace: gitea
    server: https://kubernetes.default.svc
  project: default
  source:
    chart: gitea
    targetRevision: 5.0.4
    repoURL: https://dl.gitea.io/charts/
    helm:
      releaseName: gitea
      values: |
        rbac:
          create: true

        serviceAccount:
          create: true
          name: gitea-secrets

        replicaCount: 1
        clusterDomain: cluster.local
        image:
          repository: gitea/gitea
          tag: ""
          pullPolicy: Always
          rootless: false # only possible when running 1.14 or later
        imagePullSecrets: []
        podSecurityContext:
          fsGroup: 1000
        containerSecurityContext: {}
        securityContext: {}

        service:
          http:
            type: ClusterIP
            port: 3000
            clusterIP: None
            loadBalancerSourceRanges: []
            annotations:
          ssh:
            type: ClusterIP
            port: 22
            clusterIP: None
            loadBalancerSourceRanges: []
            annotations:

        ingress:
          enabled: true
          className: nginx
          annotations:
            flame.pawelmalak/type: application # "app" works too
            flame.pawelmalak/name: Gitea
            flame.pawelmalak/url: https://gitea.2hu.net
            flame.pawelmalak/icon: https://cdn.jsdelivr.net/npm/simple-icons@v6/icons/gitea.svg
          hosts:
            - host: git.2hu.net
              paths:
                - path: /
                  pathType: Prefix

        resources: {}

        nodeSelector: {}

        tolerations: []

        affinity: {}

        statefulset:
          env: []
            # - name: VARIABLE
            #   value: my-value
          terminationGracePeriodSeconds: 60
          labels: {}

        persistence:
          enabled: true
          size: 20Gi
          accessModes:
            - ReadWriteOnce
          labels: {}
          annotations: {}

        extraVolumes:
        extraVolumeMounts:

        initPreScript: ""

        signing:
          enabled: false
          gpgHome: /data/git/.gnupg

        gitea:
          admin:
            username: johannes
            password: changeme
            email: "kulzer.johannes@tutanota.com"

          metrics:
            enabled: false
            serviceMonitor:
              enabled: false

          ldap: []

          oauth: []

          config:
            APP_NAME: "GensoNet Git Server"

          additionalConfigSources: []

          additionalConfigFromEnvs: []

          podAnnotations: {}

          livenessProbe:
            tcpSocket:
              port: http
            initialDelaySeconds: 200
            timeoutSeconds: 1
            periodSeconds: 10
            successThreshold: 1
            failureThreshold: 10

          readinessProbe:
            tcpSocket:
              port: http
            initialDelaySeconds: 5
            timeoutSeconds: 1
            periodSeconds: 10
            successThreshold: 1
            failureThreshold: 3

        memcached:
          enabled: true
          service:
            port: 11211

        postgresql:
          enabled: true
          global:
            postgresql:
              postgresqlDatabase: gitea
              postgresqlUsername: gitea
              postgresqlPassword: gitea
              servicePort: 5432
          persistence:
            size: 10Gi

        checkDeprecation: true

