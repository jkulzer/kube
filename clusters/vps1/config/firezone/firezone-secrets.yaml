---
apiVersion: secrets.esg.jkulzer.dev/v1alpha1
kind: Secret
metadata:
  name: firezone-secret
  namespace: firezone
spec:
  secret:
    name: firezone-secret
    namespace: firezone
  keys:
    - key: GUARDIAN_SECRET_KEY
      templateString: "{{ GUARDIAN_SECRET_KEY }}"
    - key: DATABASE_ENCRYPTION_KEY
      templateString: "{{ DATABASE_ENCRYPTION_KEY }}"
    - key: SECRET_KEY_BASE
      templateString: "{{ SECRET_KEY_BASE }}"
    - key: LIVE_VIEW_SIGNING_SALT
      templateString: "{{ LIVE_VIEW_SIGNING_SALT }}"
    - key: COOKIE_SIGNING_SALT
      templateString: "{{ COOKIE_SIGNING_SALT }}"
    - key: COOKIE_ENCRYPTION_SALT
      templateString: "{{ COOKIE_SIGNING_SALT }}"
  generators:
   - name: GUARDIAN_SECRET_KEY
     type: string
     length: 64
   - name: DATABASE_ENCRYPTION_KEY
     type: string
     length: 64
   - name: SECRET_KEY_BASE
     type: string
     length: 64
   - name: LIVE_VIEW_SIGNING_SALT
     type: string
     length: 64
   - name: COOKIE_SIGNING_SALT
     type: string
     length: 64
   - name: COOKIE_ENCRYPTION_SALT
     type: string
     length: 64
---
apiVersion: secrets.esg.jkulzer.dev/v1alpha1
kind: Secret
metadata:
  name: firezone-postgresql
  namespace: firezone
spec:
  secret:
    name: postgresql-password
    namespace: firezone
  keys:
    - key: POSTGRES_PASSWORD
      templateString: "{{ POSTGRES_PASSWORD }}"
  generators:
   - name: POSTGRES_PASSWORD
     type: string
     length: 64
---
apiVersion: secrets.esg.jkulzer.dev/v1alpha1
kind: Secret
metadata:
  name: firezone-oidc-secret
  namespace: firezone
spec:
  secret:
    name: firezone-oidc-secret
    namespace: firezone
  keys:
    - key: OPENID_CONNECT_PROVIDERS
      templateString: '[ { "auto_create_users": true, "id": "authelia", "label": "Authelia", "client_id": "{{ CLIENT_ID }}", "client_secret": "{{ CLIENT_SECRET }}", "discovery_document_uri": "https://auth.jkulzer.dev/.well-known/openid-configuration", "redirect_uri": "https://vpn.jkulzer.dev/auth/oidc/authelia/callback", "response_type": "code", "scope": "openid email profile" } ]'
    - key: CLIENT_ID
      templateString: "{{ CLIENT_ID }}"
    - key: CLIENT_SECRET_HASHED
      templateString: "{{ CLIENT_SECRET.hashed }}"
  generators:
   - name: CLIENT_ID
     type: string
     length: 64
   - name: CLIENT_SECRET
     type: authelia-hash
     length: 64
